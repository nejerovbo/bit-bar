#!/bin/bash
bitbar_plugin_dir='/Users/tashaejerovbo/bitbar-plugins/Enabled/bitbar'


source ~/.bash_profile
source ${bitbar_plugin_dir}/Scripts/config.cfg
heading_text="IQ"
heading_image_running="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Y3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpkYz0naHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8nPgogIDxkYzp0aXRsZT4KICAgPHJkZjpBbHQ+CiAgICA8cmRmOmxpIHhtbDpsYW5nPSd4LWRlZmF1bHQnPng8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+VGFzaGE8L3BkZjpBdXRob3I+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnhtcD0naHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyc+CiAgPHhtcDpDcmVhdG9yVG9vbD5DYW52YTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz6ZlSd5AAAAAElFTkSuQmCC"
heading_image_stopped="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NTc1ZmEzMGRjMDwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz54PC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlRhc2hhPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmE8L3htcDpDcmVhdG9yVG9vbD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSdyJz8+kRcKSAAAAABJRU5ErkJggg=="
process="nexus-iq-server"

stop_script=${bitbar_plugin_dir}"/Scripts/stop-iq.sh"
start_script=${bitbar_plugin_dir}"/Scripts/start-iq.sh"
port_match="8070"
app_config_file=${iq_dir}"/config.yml"
server_address="http://localhost:"
port="$(grep ${port_match} ${app_config_file} | grep -v '#' -m 1)"
server_view_path=""
ps aux | grep ${process} | grep -v grep >/dev/null 2>&1
#$? is exit status in Grep
#0 means a match was found
#1 means no lines were found
#2 and above is an error
result=$?
verbose="-x"

bash "${bitbar_plugin_dir}/Scripts/MenuFunction-IQ.sh" "${heading_text}" "${heading_image_running}" "${heading_image_stopped}" "${process}" "${stop_script}" "${start_script}" "${port}" "${app_config_file}" "${server_address}" "${server_view_path}" "${result}"
